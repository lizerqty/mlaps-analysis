<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MLAPS v2: Interactive Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Helvetica Neue", Arial, sans-serif;
        background: #f5f7fa;
        margin: 0;
        padding: 0;
        color: #1a1a1a;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        min-height: 100vh;
      }

      .header {
        background: #003d82;
        color: white;
        padding: 30px 50px;
        border-bottom: 3px solid #0055b8;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 5px;
        font-weight: 300;
        letter-spacing: -1px;
      }

      .header p {
        font-size: 1em;
        opacity: 0.9;
        font-weight: 300;
      }

      .tabs {
        display: flex;
        background: #ffffff;
        border-bottom: 1px solid #e0e0e0;
      }

      .tab {
        flex: 1;
        padding: 18px 30px;
        text-align: center;
        cursor: pointer;
        background: #ffffff;
        border: none;
        font-size: 0.95em;
        font-weight: 500;
        transition: all 0.2s;
        color: #5a6c7d;
        border-bottom: 3px solid transparent;
        letter-spacing: 0.3px;
      }

      .tab:hover {
        background: #f8f9fa;
        color: #003d82;
      }

      .tab.active {
        background: white;
        color: #003d82;
        border-bottom: 3px solid #0055b8;
        font-weight: 600;
      }

      .tab-content {
        display: none;
        padding: 50px 60px;
        animation: fadeIn 0.3s ease-out;
        background: #f5f7fa;
        min-height: 600px;
      }

      .tab-content.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .upload-section {
        background: #ffffff;
        border: 2px solid #e0e0e0;
        border-radius: 4px;
        padding: 50px;
        text-align: center;
        margin-bottom: 30px;
        transition: all 0.2s;
      }

      .upload-section:hover {
        border-color: #0055b8;
        background: #f8f9fa;
      }

      .upload-button {
        background: #003d82;
        color: white;
        border: none;
        padding: 14px 40px;
        border-radius: 2px;
        font-size: 0.95em;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }

      .upload-button:hover {
        background: #0055b8;
      }

      #fileInput {
        display: none;
      }

      .chart-container {
        margin: 30px 0;
        padding: 30px;
        background: white;
        border-radius: 2px;
        border: 1px solid #e0e0e0;
      }

      .section-header {
        color: #003d82;
        font-weight: 400;
        font-size: 1.4em;
        margin: 40px 0 20px 0;
        padding-bottom: 12px;
        border-bottom: 2px solid #e0e0e0;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .metric-card {
        background: #ffffff;
        color: #1a1a1a;
        padding: 25px 30px;
        border-radius: 2px;
        border-left: 4px solid #0055b8;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        transition: all 0.2s;
      }

      .metric-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        border-left-color: #003d82;
      }

      .metric-card h3 {
        font-size: 0.85em;
        margin-bottom: 12px;
        color: #5a6c7d;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .metric-card .value {
        font-size: 2.2em;
        font-weight: 300;
        margin-bottom: 5px;
        color: #003d82;
      }

      .metric-card .label {
        font-size: 0.85em;
        color: #7a8a9a;
        font-weight: 400;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        border: 1px solid #e0e0e0;
        background: white;
      }

      th {
        background: #f8f9fa;
        color: #1a1a1a;
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 0.85em;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 2px solid #003d82;
      }

      td {
        padding: 16px 20px;
        border-bottom: 1px solid #f0f0f0;
        font-size: 0.95em;
      }

      tr:hover {
        background: #f8f9fa;
      }

      .alert {
        padding: 16px 24px;
        border-radius: 2px;
        margin: 20px 0;
        display: none;
        font-size: 0.9em;
      }

      .alert-success {
        background: #f0f9f4;
        color: #1e5631;
        border-left: 4px solid #2d7a4a;
      }

      .alert-info {
        background: #f0f7ff;
        color: #003d82;
        border-left: 4px solid #0055b8;
      }

      .methodology {
        background: #ffffff;
        padding: 40px;
        line-height: 1.8;
        max-width: 1200px;
      }

      .methodology h2 {
        color: #003d82;
        font-weight: 300;
        font-size: 2em;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e0e0e0;
      }

      .methodology h3 {
        color: #003d82;
        margin-top: 35px;
        margin-bottom: 15px;
        font-weight: 500;
        font-size: 1.4em;
      }

      .methodology h4 {
        color: #5a6c7d;
        margin-top: 25px;
        margin-bottom: 12px;
        font-weight: 500;
        font-size: 1.1em;
      }

      .methodology ul {
        margin-left: 20px;
      }

      .methodology li {
        margin: 10px 0;
      }

      .footer {
        background: #003d82;
        color: white;
        padding: 40px 50px;
        text-align: center;
        font-size: 0.9em;
        border-top: 3px solid #0055b8;
      }

      .rank-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 2px;
        font-weight: 600;
        font-size: 0.85em;
        letter-spacing: 0.3px;
      }

      .rank-1 {
        background: #003d82;
        color: white;
        border: 2px solid #003d82;
      }
      .rank-2 {
        background: #0055b8;
        color: white;
        border: 2px solid #0055b8;
      }
      .rank-3 {
        background: #1a75d2;
        color: white;
        border: 2px solid #1a75d2;
      }
      .rank-other {
        background: #f8f9fa;
        color: #5a6c7d;
        border: 2px solid #e0e0e0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>MLAPS v2</h1>
        <p style="font-size: 1.1em; margin-top: 8px; font-weight: 400">
          Macro-Liquidity Aligned Property Score
        </p>
        <p style="font-size: 0.85em; margin-top: 12px; opacity: 0.85">
          Investment Analytics Platform | Risk-Aware, Cycle-Aware Property
          Analysis
        </p>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="showTab('dashboard')">
          Dashboard
        </button>
        <button class="tab" onclick="showTab('data')">Data Explorer</button>
        <button class="tab" onclick="showTab('methodology')">
          Methodology
        </button>
      </div>

      <!-- Dashboard Tab -->
      <div id="dashboard" class="tab-content active">
        <div class="upload-section">
          <h2
            style="
              color: #003d82;
              font-weight: 400;
              font-size: 1.5em;
              margin-bottom: 15px;
            "
          >
            Load Data
          </h2>
          <p style="margin: 20px 0; color: #5a6c7d; font-size: 0.95em">
            Upload mlaps_scores_v2.csv to visualize results
          </p>
          <button
            class="upload-button"
            onclick="document.getElementById('fileInput').click()"
          >
            Choose CSV File
          </button>
          <input
            type="file"
            id="fileInput"
            accept=".csv"
            onchange="loadCSVFile(event)"
          />
        </div>

        <div id="alertSuccess" class="alert alert-success">
          <strong>Data loaded successfully.</strong>
          <span id="rowCount"></span> suburbs analyzed.
        </div>

        <div id="summarySection" style="display: none">
          <h3 class="section-header">Key Metrics</h3>
          <div class="metrics-grid" id="metricsGrid">
            <!-- Metrics will be inserted here -->
          </div>
        </div>

        <div id="chartsSection" style="display: none">
          <h3 class="section-header">Performance Analysis</h3>
          <div class="chart-container">
            <div id="rankingsChart"></div>
          </div>

          <div class="chart-container">
            <div id="componentsChart"></div>
          </div>

          <h3 class="section-header">Correlation Analysis</h3>
          <div class="chart-container">
            <div id="scatterChart"></div>
          </div>

          <div class="chart-container">
            <div id="correlationChart"></div>
          </div>
        </div>
      </div>

      <!-- Data Explorer Tab -->
      <div id="data" class="tab-content">
        <h2
          style="
            color: #003d82;
            font-weight: 300;
            font-size: 2em;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
          "
        >
          Suburb Rankings
        </h2>
        <div id="dataTable">
          <p
            style="
              text-align: center;
              color: #5a6c7d;
              padding: 60px;
              font-size: 1.05em;
            "
          >
            Load a CSV file to view detailed rankings
          </p>
        </div>
      </div>

      <!-- Methodology Tab -->
      <div id="methodology" class="tab-content">
        <div class="methodology">
          <h2>MLAPS v2 Methodology</h2>

          <h3>What is MLAPS?</h3>
          <p>
            MLAPS (Macro-Liquidity Aligned Property Score) is a composite metric
            (0-100) that ranks Australian residential property markets by
            combining four critical investment factors: local market liquidity,
            macro-economic cycle alignment, price momentum, and downside risk
            protection.
          </p>

          <h3>Component Metrics</h3>

          <h4>1. Local Market Liquidity (LML) - 35% weight</h4>
          <ul>
            <li>
              <strong>Formula:</strong> LML = (12-month sales ÷ dwelling stock)
              × 100
            </li>
            <li><strong>Units:</strong> % per year</li>
            <li>
              <strong>Interpretation:</strong> Higher = easier to buy/sell,
              lower liquidity risk
            </li>
            <li><strong>Minimum:</strong> 5 sales required for reliability</li>
          </ul>

          <h4>2. Macro Liquidity Alignment (MLA) - 40% weight</h4>
          <ul>
            <li>
              <strong>Formula:</strong> Pearson correlation between local price
              returns and global liquidity proxy
            </li>
            <li><strong>Lead:</strong> Macro proxy leads by 10 weeks</li>
            <li><strong>Window:</strong> 36-month rolling correlation</li>
            <li>
              <strong>Significance:</strong> p < 0.10 required; non-significant
              correlations set to neutral (50)
            </li>
            <li>
              <strong>Interpretation:</strong> Positive = catches macro
              tailwinds during QE periods
            </li>
          </ul>

          <h4>3. Price Momentum (MOM) - 15% weight</h4>
          <ul>
            <li>
              <strong>Formula:</strong> Annualized growth rate (recent 30% vs
              older 30% of sales)
            </li>
            <li><strong>Units:</strong> % per annum</li>
            <li>
              <strong>Outlier control:</strong> Winsorized at 2.5/97.5
              percentiles
            </li>
            <li><strong>Minimum:</strong> 15 sales required</li>
            <li>
              <strong>Interpretation:</strong> Positive = prices rising,
              negative = declining
            </li>
          </ul>

          <h4>4. Drawdown Risk (DDR) - 10% weight</h4>
          <ul>
            <li>
              <strong>Formula:</strong> Maximum peak-to-trough price decline
            </li>
            <li><strong>Smoothing:</strong> 3-quarter moving average</li>
            <li><strong>Cap:</strong> -35% floor to avoid outlier dominance</li>
            <li><strong>Lookback:</strong> 24 months (8 quarters minimum)</li>
            <li>
              <strong>Interpretation:</strong> Less negative = more stable,
              lower downside risk
            </li>
          </ul>

          <h3>Normalization & Composite</h3>
          <ul>
            <li>
              <strong>Step 1:</strong> Calculate z-scores for each metric per
              suburb
            </li>
            <li>
              <strong>Step 2:</strong> Cap z-scores at ±2.5σ to reduce outlier
              leverage
            </li>
            <li><strong>Step 3:</strong> Min-max normalize to 0-100 scale</li>
            <li>
              <strong>Step 4:</strong> Apply weights: 40% MLA + 35% LML + 15%
              MOM + 10% DDR
            </li>
            <li>
              <strong>Fallback:</strong> If MLA unavailable, reweight as 50% LML
              + 30% MOM + 20% DDR
            </li>
          </ul>

          <h3>Improvements from v1</h3>
          <ul>
            <li>✓ Fixed unrealistic drawdowns (-64% to -89% → -28% to -35%)</li>
            <li>
              ✓ Added 3-quarter moving average smoothing for DD calculation
            </li>
            <li>✓ Winsorization at 2.5/97.5 percentiles for momentum</li>
            <li>✓ Statistical significance testing for MLA (p < 0.10)</li>
            <li>✓ Fisher z-transform for MLA confidence intervals</li>
            <li>✓ Proper unit labeling (% per year for liquidity)</li>
            <li>✓ Z-score capping at ±2.5σ before normalization</li>
            <li>✓ Minimum sample requirements with reliability flags</li>
          </ul>

          <h3>Limitations & Caveats</h3>
          <ul>
            <li>
              Requires minimum transaction volumes (excludes low-volume suburbs)
            </li>
            <li>
              Macro proxy is synthetic (production should use real BTC/Global
              M2)
            </li>
            <li>No property-type segmentation (houses vs units)</li>
            <li>Historical patterns provide guidance, not guarantees</li>
            <li>
              Suburb-level only (individual properties vary significantly)
            </li>
            <li>
              Correlation time-varying (treat MLA as context, not short-term
              signal)
            </li>
          </ul>

          <h3>For Investors</h3>
          <p><strong>Use MLAPS to:</strong></p>
          <ul>
            <li>Shortlist suburbs for further research</li>
            <li>Compare opportunity/risk profiles across markets</li>
            <li>
              Time macro cycles (buy high-MLA areas during liquidity expansion)
            </li>
            <li>Avoid liquidity traps (focus on healthy turnover)</li>
          </ul>

          <p style="margin-top: 20px">
            <strong>Important Considerations:</strong>
          </p>
          <ul>
            <li>Not for property-specific purchase decisions</li>
            <li>Medium-term investment horizon (not short-term trading)</li>
            <li>
              Supplement to, not replacement for, professional due diligence
            </li>
          </ul>
        </div>
      </div>

      <div class="footer">
        <div style="max-width: 1200px; margin: 0 auto">
          <p style="font-size: 1em; font-weight: 300; letter-spacing: 0.5px">
            MLAPS v2 | Macro-Liquidity Aligned Property Score
          </p>
          <p style="margin-top: 12px; font-size: 0.85em; opacity: 0.8">
            Investment Analytics Platform | Microburbs Assessment | October 2025
          </p>
          <p
            style="
              margin-top: 20px;
              font-size: 0.75em;
              opacity: 0.6;
              padding-top: 20px;
              border-top: 1px solid rgba(255, 255, 255, 0.2);
            "
          >
            This analysis is provided for informational purposes only and does
            not constitute investment advice. Past performance is not indicative
            of future results. Consult a qualified professional before making
            investment decisions.
          </p>
        </div>
      </div>
    </div>

    <script>
      let currentData = null;

      function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.querySelectorAll(".tab").forEach((btn) => {
          btn.classList.remove("active");
        });

        // Show selected tab
        document.getElementById(tabName).classList.add("active");
        event.target.classList.add("active");
      }

      function loadCSVFile(event) {
        const file = event.target.files[0];
        if (!file) return;

        Papa.parse(file, {
          header: true,
          dynamicTyping: true,
          complete: function (results) {
            currentData = results.data.filter((row) => row.suburb);
            displayData();
            createCharts();
            document.getElementById("alertSuccess").style.display = "block";
            document.getElementById("rowCount").textContent =
              currentData.length;
            document.getElementById("summarySection").style.display = "block";
            document.getElementById("chartsSection").style.display = "block";
          },
        });
      }

      function displayData() {
        if (!currentData) return;

        // Create metrics cards
        const metricsHTML = `
                <div class="metric-card">
                    <h3>Suburbs Analyzed</h3>
                    <div class="value">${currentData.length}</div>
                    <div class="label">Total Markets</div>
                </div>
                <div class="metric-card">
                    <h3>Top MLAPS</h3>
                    <div class="value">${
                      currentData[0]?.MLAPS?.toFixed(1) || "N/A"
                    }</div>
                    <div class="label">${currentData[0]?.suburb || "N/A"}</div>
                </div>
                <div class="metric-card">
                    <h3>Avg Liquidity</h3>
                    <div class="value">${(
                      currentData.reduce((a, b) => a + (b.LML || 0), 0) /
                      currentData.length
                    ).toFixed(2)}%</div>
                    <div class="label">Per Year</div>
                </div>
                <div class="metric-card">
                    <h3>Avg Momentum</h3>
                    <div class="value">${(
                      currentData.reduce((a, b) => a + (b.MOM || 0), 0) /
                      currentData.length
                    ).toFixed(1)}%</div>
                    <div class="label">Per Annum</div>
                </div>
            `;
        document.getElementById("metricsGrid").innerHTML = metricsHTML;

        // Create data table
        let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Suburb</th>
                            <th>MLAPS</th>
                            <th>Liquidity (%/yr)</th>
                            <th>Momentum (%p.a.)</th>
                            <th>Drawdown (%)</th>
                            <th>Macro Align</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        currentData.forEach((row, idx) => {
          const rankClass =
            idx === 0
              ? "rank-1"
              : idx === 1
              ? "rank-2"
              : idx === 2
              ? "rank-3"
              : "rank-other";
          tableHTML += `
                    <tr>
                        <td><span class="rank-badge ${rankClass}">#${
            row.rank || idx + 1
          }</span></td>
                        <td><strong>${row.suburb}</strong></td>
                        <td><strong>${
                          row.MLAPS?.toFixed(1) || "N/A"
                        }</strong></td>
                        <td>${row.LML?.toFixed(2) || "N/A"}</td>
                        <td>${row.MOM?.toFixed(1) || "N/A"}</td>
                        <td>${row.DDR?.toFixed(1) || "N/A"}</td>
                        <td>${row.MLA?.toFixed(3) || "N/A"}</td>
                        <td>$${(row.latest_price || 0).toLocaleString()}</td>
                    </tr>
                `;
        });

        tableHTML += `</tbody></table>`;
        document.getElementById("dataTable").innerHTML = tableHTML;
      }

      function createCharts() {
        if (!currentData) return;

        // Sort by MLAPS
        const sortedData = [...currentData].sort((a, b) => b.MLAPS - a.MLAPS);

        // 1. Rankings Bar Chart
        const rankingsTrace = {
          x: sortedData.map((d) => d.MLAPS),
          y: sortedData.map((d) => d.suburb),
          type: "bar",
          orientation: "h",
          marker: {
            color: sortedData.map((d) => d.MLAPS),
            colorscale: [
              [0, "#95a5a6"],
              [0.5, "#0055b8"],
              [1, "#003d82"],
            ],
            showscale: true,
            colorbar: {
              title: { text: "Score", font: { size: 11 } },
              thickness: 15,
            },
          },
          text: sortedData.map((d) => d.MLAPS.toFixed(1)),
          textposition: "outside",
          textfont: { color: "#003d82", weight: 600 },
        };

        Plotly.newPlot("rankingsChart", [rankingsTrace], {
          title: {
            text: "MLAPS v2 Rankings by Suburb",
            font: {
              size: 18,
              color: "#003d82",
              family: "Helvetica Neue, Arial",
            },
          },
          xaxis: {
            title: {
              text: "MLAPS Score (0-100)",
              font: { size: 13, color: "#5a6c7d" },
            },
            gridcolor: "#e8ecef",
            showline: true,
            linecolor: "#d0d5da",
            tickfont: { size: 11, color: "#5a6c7d" },
          },
          yaxis: {
            tickfont: { size: 11, color: "#1a1a1a" },
            showline: false,
          },
          height: 400,
          margin: { l: 150, r: 60, t: 60, b: 60 },
          plot_bgcolor: "#ffffff",
          paper_bgcolor: "#ffffff",
          font: { family: "Helvetica Neue, Arial" },
        });

        // 2. Component Stacked Bar Chart
        const componentsTrace1 = {
          x: sortedData.map((d) => d.suburb),
          y: sortedData.map((d) => (d.MLA_score || 50) * 0.4),
          name: "Macro Align (40%)",
          type: "bar",
          marker: { color: "#003d82" },
        };
        const componentsTrace2 = {
          x: sortedData.map((d) => d.suburb),
          y: sortedData.map((d) => (d.LML_score || 50) * 0.35),
          name: "Liquidity (35%)",
          type: "bar",
          marker: { color: "#0055b8" },
        };
        const componentsTrace3 = {
          x: sortedData.map((d) => d.suburb),
          y: sortedData.map((d) => (d.MOM_score || 50) * 0.15),
          name: "Momentum (15%)",
          type: "bar",
          marker: { color: "#1a75d2" },
        };
        const componentsTrace4 = {
          x: sortedData.map((d) => d.suburb),
          y: sortedData.map((d) => (d.DDR_score || 50) * 0.1),
          name: "Risk (10%)",
          type: "bar",
          marker: { color: "#5a6c7d" },
        };

        Plotly.newPlot(
          "componentsChart",
          [
            componentsTrace1,
            componentsTrace2,
            componentsTrace3,
            componentsTrace4,
          ],
          {
            title: {
              text: "MLAPS Component Breakdown",
              font: {
                size: 18,
                color: "#003d82",
                family: "Helvetica Neue, Arial",
              },
            },
            barmode: "stack",
            yaxis: {
              title: {
                text: "Weighted Component Contribution",
                font: { size: 13, color: "#5a6c7d" },
              },
              gridcolor: "#e8ecef",
              showline: true,
              linecolor: "#d0d5da",
              tickfont: { size: 11, color: "#5a6c7d" },
            },
            xaxis: {
              tickfont: { size: 11, color: "#1a1a1a" },
              showline: true,
              linecolor: "#d0d5da",
            },
            height: 400,
            margin: { l: 80, r: 60, t: 60, b: 80 },
            plot_bgcolor: "#ffffff",
            paper_bgcolor: "#ffffff",
            showlegend: true,
            legend: {
              x: 1,
              xanchor: "right",
              y: 1,
              font: { size: 11, color: "#5a6c7d" },
              bgcolor: "rgba(255,255,255,0.8)",
              bordercolor: "#e0e0e0",
              borderwidth: 1,
            },
            font: { family: "Helvetica Neue, Arial" },
          }
        );

        // 3. Scatter: Liquidity vs Momentum
        const scatterTrace = {
          x: currentData.map((d) => d.LML),
          y: currentData.map((d) => d.MOM),
          mode: "markers+text",
          type: "scatter",
          text: currentData.map((d) => d.suburb),
          textposition: "top center",
          textfont: { size: 10, color: "#003d82" },
          marker: {
            size: currentData.map((d) => d.MLAPS * 0.8),
            color: currentData.map((d) => d.MLAPS),
            colorscale: [
              [0, "#cbd5e0"],
              [0.5, "#0055b8"],
              [1, "#003d82"],
            ],
            showscale: true,
            colorbar: {
              title: { text: "MLAPS Score", font: { size: 11 } },
              thickness: 15,
            },
            line: { color: "white", width: 2 },
          },
        };

        Plotly.newPlot("scatterChart", [scatterTrace], {
          title: {
            text: "Liquidity vs Momentum (bubble size = MLAPS)",
            font: {
              size: 18,
              color: "#003d82",
              family: "Helvetica Neue, Arial",
            },
          },
          xaxis: {
            title: {
              text: "Liquidity (% per year)",
              font: { size: 13, color: "#5a6c7d" },
            },
            gridcolor: "#e8ecef",
            showline: true,
            linecolor: "#d0d5da",
            tickfont: { size: 11, color: "#5a6c7d" },
            zeroline: false,
          },
          yaxis: {
            title: {
              text: "Momentum (% p.a.)",
              font: { size: 13, color: "#5a6c7d" },
            },
            gridcolor: "#e8ecef",
            showline: true,
            linecolor: "#d0d5da",
            tickfont: { size: 11, color: "#5a6c7d" },
            zeroline: true,
            zerolinecolor: "#d0d5da",
          },
          height: 500,
          margin: { l: 80, r: 80, t: 60, b: 60 },
          plot_bgcolor: "#ffffff",
          paper_bgcolor: "#ffffff",
          font: { family: "Helvetica Neue, Arial" },
        });

        // 4. Drawdown vs Price scatter
        const correlationTrace = {
          x: currentData.map((d) => d.DDR),
          y: currentData.map((d) => d.latest_price),
          mode: "markers+text",
          type: "scatter",
          text: currentData.map((d) => d.suburb),
          textposition: "top center",
          textfont: { size: 10, color: "#003d82" },
          marker: {
            size: 16,
            color: currentData.map((d) => d.MLAPS),
            colorscale: [
              [0, "#cbd5e0"],
              [0.5, "#0055b8"],
              [1, "#003d82"],
            ],
            showscale: true,
            colorbar: {
              title: { text: "MLAPS Score", font: { size: 11 } },
              thickness: 15,
            },
            line: { color: "white", width: 2 },
          },
        };

        Plotly.newPlot("correlationChart", [correlationTrace], {
          title: {
            text: "Drawdown Risk vs Price (color = MLAPS)",
            font: {
              size: 18,
              color: "#003d82",
              family: "Helvetica Neue, Arial",
            },
          },
          xaxis: {
            title: {
              text: "Drawdown Risk (%)",
              font: { size: 13, color: "#5a6c7d" },
            },
            gridcolor: "#e8ecef",
            showline: true,
            linecolor: "#d0d5da",
            tickfont: { size: 11, color: "#5a6c7d" },
          },
          yaxis: {
            title: {
              text: "Median Price ($)",
              font: { size: 13, color: "#5a6c7d" },
            },
            gridcolor: "#e8ecef",
            showline: true,
            linecolor: "#d0d5da",
            tickfont: { size: 11, color: "#5a6c7d" },
          },
          height: 500,
          margin: { l: 100, r: 80, t: 60, b: 60 },
          plot_bgcolor: "#ffffff",
          paper_bgcolor: "#ffffff",
          font: { family: "Helvetica Neue, Arial" },
        });
      }
    </script>
  </body>
</html>
